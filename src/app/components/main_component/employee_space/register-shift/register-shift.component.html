<div class="body bg-white">
    <div class="title border-bottom d-flex justify-content-between align-items-center pb-1">
        <h4 class="m-1">{{ title }}</h4>
    </div>

    <nz-table #rowSelectionTable id="table" [nzLoading]="loading" nzShowSizeChanger [nzData]="schedules">
        <thead>
            <tr>
                <th>#</th>
                <th *ngFor="let column of listOfColumn" [nzSortFn]="column.compare" [nzSortPriority]="column.priority">
                    {{ column.title }}
                </th>
                <th>Trạng thái</th>
                <th style="width: 10%;" class="text-center"></th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let data of rowSelectionTable.data; let i = index">
                <td>{{ i + 1 }}</td>
                <td>{{ employeeName(data.employeeID) }}</td>
                <td>{{ shiftName(data.shiftID) }}</td>
                <td>{{ dateFormat(data.workDate) }}</td>
                <td *ngIf="data.approvedBy != null && !(this.width > 600 && this.width <= 1024)">{{ data.approvedBy }}
                    <br /> <span>{{
                        dateTimeFormat(data.approvedAt!) }}</span></td>
                <td *ngIf="data.approvedBy == null && !(this.width > 600 && this.width <= 1024)"></td>
                <td *ngIf="data.createdBy != null && !(this.width > 600 && this.width <= 1024)">{{ data.createdBy }}
                    <br /> <span>{{ dateTimeFormat(data.createdAt!)
                        }}</span></td>
                <td *ngIf="data.createdBy == null && !(this.width > 600 && this.width <= 1024)"></td>
                <td>
                    <span [class]="['status', data.isInProgress ? 'inProgress' : data.isSubmit ? 'submitted' : 'rejected']">
                        {{ data.isInProgress ? 'Đang chờ' : data.isSubmit ? 'Đã duyệt' : 'Bị từ chối' }}
                    </span> 
                </td>
                <td class="text-center">
                    <div class="d-flex w-100 justify-content-between align-items-center" *ngIf="data.isInProgress">
                        <button nz-button nzType="primary">
                            <span nz-icon nzType="info-circle" class="text-white" nzTheme="outline"></span>
                        </button>
                        <button nz-button nzType="primary" nzTooltipTitle="Duyệt" nzTooltipPlacement="top" nz-tooltip
                            (click)="confirm(data.scheduleID, 'approve')">
                            <span class="text-white" nz-icon nzType="check" nzTheme="outline"></span>
                        </button>
                        <button nz-button nzType="primary" nzDanger nzTooltipTitle="Từ chối" nzTooltipPlacement="top"
                            nz-tooltip
                            (click)="confirm(data.scheduleID, 'reject')"
                        >
                            <span class="text-white" nz-icon nzType="close" nzTheme="outline"></span>
                        </button>
                    </div>

                    <div class="d-flex w-100 align-items-center" *ngIf="!data.isInProgress">
                        <button nz-button nzType="primary">
                            <span nz-icon nzType="info-circle" class="text-white" nzTheme="outline"></span>
                        </button>
                        <button class="delete-btn" nz-button nzType="primary" nz-popconfirm
                            [nzPopconfirmTitle]="'Bạn có muốn xóa ?'" nzPopconfirmPlacement="top"
                            (nzOnConfirm)="delete(data.scheduleID)"
                        >
                            <span class="text-white" nz-icon nzType="delete" nzTheme="outline"></span>
                        </button>
                    </div>
                </td>
            </tr>
        </tbody>
    </nz-table>

    <form nz-form [formGroup]="validateForm" class="mt-4" *ngIf="title == 'Đăng ký ca'" (ngSubmit)="submit()">
        <nz-form-item>
            <nz-form-label class="text-start" [nzSpan]="6" nzRequired>Nhân viên</nz-form-label>
            <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..."
                nzErrorTip="Vui lòng chọn nhân viên!">
                <nz-select formControlName="employee" nzPlaceHolder="Chọn nhân viên" nzAllowClear>
                    <nz-option *ngFor="let emp of employees" [nzValue]="emp.employeeID"
                        [nzLabel]="emp.fullname"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>
        <nz-form-item>
            <nz-form-label class="text-start" [nzSpan]="6" nzRequired>Ngày đăng ký</nz-form-label>
            <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..."
                nzErrorTip="Vui lòng chọn ngày!">
                <nz-date-picker nzMode="date" class="w-100" formControlName="workDate"
                    nzPlaceHolder="Chọn thời gian"></nz-date-picker>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-label class="text-start" [nzSpan]="6" nzRequired>Loại ca</nz-form-label>
            <nz-form-control [nzSpan]="12" nzHasFeedback nzValidatingTip="Validating..."
                nzErrorTip="Vui lòng chọn ca làm!">
                <nz-select formControlName="shift" nzPlaceHolder="Chọn ca làm" nzAllowClear>
                    <nz-option *ngFor="let shift of shifts" [nzValue]="shift.shiftID"
                        [nzLabel]="shift.shiftName + ' ( ' + shift.startTime + ' - ' + shift.endTime + ' )'"></nz-option>
                </nz-select>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-label class="text-start" [nzSpan]="6" nzRequired>Nội dung</nz-form-label>
            <nz-form-control [nzSpan]="12">
                <textarea rows="4" nz-input formControlName="description" placeholder="Comment here"></textarea>
            </nz-form-control>
        </nz-form-item>

        <nz-form-item>
            <nz-form-control [nzOffset]="7" [nzSpan]="12">
                <button nz-button nzType="primary" [disabled]="!validateForm.valid">Submit</button>
                <button nz-button (click)="resetForm($event)">Reset</button>
            </nz-form-control>
        </nz-form-item>
    </form>
</div>